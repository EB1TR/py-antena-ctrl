<!doctype html>
<html lang="es">
        <head>
                <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
                <script src="mqtt.js" type="text/javascript"></script>
                <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
                <link rel="stylesheet" href="style.css">
                <meta charset="utf-8">
                <title>Antenna Control</title>
        </head>
        <body style="text-align: center">
                <div id="contenor">
                        <table class="tablestn">
                                <tr>
                                        <td class="colcentered texto-stn" colspan="7">
                                                <span style="width: 100px; display: inline-block; align-content: center;" id="stn1-r1-qrg">----.--</span>
                                                <span style="width: 80px; display: inline-block; align-content: center;" id="stn1-r1-pwrp">---</span>
                                                <span style="width: 60px; display: inline-block; align-content: center;" id="stn1-r1-swr">---</span>
                                                <span style="width: 60px; display: inline-block; align-content: center;" id="stn1-r1-va">---</span>
                                                <span style="width: 60px; display: inline-block; align-content: center;" id="stn1-r1-temp">---</span>
                                                <hr>
                                        </td>
                                </tr>
                                <tr>
                                        <td class="tdstn"><a href="#"><span onclick="send_command('set/stn1/stack', 1)" class="spanitem" id="stn1-stack1">1</span></a></td>
                                        <td class="tdstn"><a href="#"><span onclick="send_command('set/stn1/stack', 2)" class="spanitem" id="stn1-stack2">2</span></a></td>
                                        <td class="tdstn"><a href="#"><span onclick="send_command('set/stn1/stack', 3)" class="spanitem" id="stn1-stack3">3</span></a></td>
                                        <td class="tdstn"><a href="#"><span onclick="send_command('set/stn1/nostack', 1)" class="spanitemtw spanitemtwy" id="stn1-nostack">SWAP</span></a></td>
                                        <td class="tdstn"></td>
                                        <td class="tdstn"></td>
                                        <td class="tdstn"><a href="#"><span onclick="send_command('set/stn1/antm', 0)" class="spanitem" id="stn1-as">AUTO</span></a></td>
                                </tr>
                        </table>
                        <br>
                        <table class="tablestn">
                                <tr>
                                        <td class="colcentered texto-stn" colspan="7">
                                                <span style="width: 100px; display: inline-block; align-content: center;" id="stn2-r1-qrg">----.--</span>
                                                <span style="width: 80px; display: inline-block; align-content: center;" id="stn2-r1-pwrp">---</span>
                                                <span style="width: 60px; display: inline-block; align-content: center;" id="stn2-r1-swr">---</span>
                                                <span style="width: 60px; display: inline-block; align-content: center;" id="stn2-r1-va">---</span>
                                                <span style="width: 60px; display: inline-block; align-content: center;" id="stn2-r1-temp">---</span>
                                                <hr>
                                        </td>
                                </tr>
                                <tr>
                                        <td class="tdstn"><a href="#"><span onclick="send_command('set/stn2/stack', 1)" class="spanitem" id="stn2-stack1">1</span></a></td>
                                        <td class="tdstn"><a href="#"><span onclick="send_command('set/stn2/stack', 2)" class="spanitem" id="stn2-stack2">2</span></a></td>
                                        <td class="tdstn"><a href="#"><span onclick="send_command('set/stn2/stack', 3)" class="spanitem" id="stn2-stack3">3</span></a></td>
                                        <td class="tdstn"><a href="#"><span onclick="send_command('set/stn2/nostack', 1)" class="spanitemtw spanitemtwy" id="stn2-nostack">SWAP</span></a></td>
                                        <td class="tdstn"></td>
                                        <td class="tdstn"></td>
                                        <td class="tdstn"><a href="#"><span onclick="send_command('set/stn2/antm', 0)" class="spanitem" id="stn2-as">AUTO</span></a></td>
                                </tr>
                        </table>
                        <br>
                        <table class="tablestn">
                                <tr>
                                        <td class="colcentered texto-stn" colspan="2"><span style="font-size: 24px;">C31XR</span></td>
                                        <td class="colcentered texto-stn" colspan="2"><a href="#"><span class="spanitem"  onclick="send_command('tw3/set/mode', 'invert')" style="font-size: 16px;" id="tw3mode">---</span></a></td>
                                        <td class="colcentered texto-stn"><span style="font-size: 24px;" id="tw3set">---</span></td>
                                        <td class="colcentered texto-stn" colspan="2"><span style="font-size: 24px;" id="tw3nec">---</span><br></td>
                                </tr>
                                <tr>
                                        <td><span class="spanitem spanitemw" id="tw3stn1">STN1</span></td>
                                        <td class="tdstn"><a href="#"><span title="-5° TW3" class="spanitemtw spanitemtwy" id="tw3sp_minus" style="height: 52px; line-height: 52px; font-size: 18px;">−</span></a></td>
                                        <td class="colcentered texto-stn" colspan="3"><span style="font-size: 79px;" id="tw3">---</span></td>
                                        <td class="tdstn"><a href="#"><span title="+5° TW3" class="spanitemtw spanitemtwy" id="tw3sp_plus" style="height: 52px; line-height: 52px; font-size: 18px;">+</span></a></td>
                                        <td><span class="spanitem spanitemw" id="tw3stn2">STN2</span></td>
                                </tr>

                                <tr>
                                        <td class="tdstn"><a href="#"><span title="SAf" onclick="send_command('tw3/set/deg', 170)" class="spanitemtw" id="tw3sp0">SAf</span></a></td>
                                        <td class="tdstn"><a href="#"><span title="SAm" onclick="send_command('tw3/set/deg', 225)" class="spanitemtw" id="tw3sp1">SAm</span></a></td>
                                        <td class="tdstn"><a href="#"><span title="CAm" onclick="send_command('tw3/set/deg', 265)" class="spanitemtw" id="tw3sp2">CAm</span></a></td>
                                        <td class="tdstn"><a href="#"><span title="NAm" onclick="send_command('tw3/set/deg', 300)" class="spanitemtw" id="tw3sp3">NAm</span></a></td>
                                        <td class="tdstn"><a href="#"><span title="JA" onclick="send_command('tw3/set/deg', 27)" class="spanitemtw" id="tw3sp4">JA</span></a></td>
                                        <td class="tdstn"><a href="#"><span title="EU" onclick="send_command('tw3/set/deg', 45)" class="spanitemtw" id="tw3sp5">EU</span></a></td>
                                        <td class="tdstn"><a href="#"><span title="MEa" onclick="send_command('tw3/set/deg', 80)" class="spanitemtw" id="tw3sp6">MEa</span></a></td>
                                </tr>
                        </table>
                        <br>
                        <table class="tablestn">
                                <tr>
                                        <td class="colcentered texto-stn" colspan="2"><span style="font-size: 24px;">MB7</span></td>
                                        <td class="colcentered texto-stn" colspan="2"><a href="#"><span class="spanitem"  onclick="send_command('tw1/set/mode', 'invert')" style="font-size: 16px;" id="tw1mode">---</span></a></td>
                                        <td class="colcentered texto-stn"><span style="font-size: 24px;" id="tw1set">---</span></td>
                                        <td class="colcentered texto-stn" colspan="2"><span style="font-size: 24px;" id="tw1nec">---</span><br></td>
                                </tr>
                                <tr>
                                        <td><span class="spanitem spanitemw" id="tw1stn1">STN1</span></td>
                                        <td class="tdstn"><a href="#"><span title="-5° TW1" class="spanitemtw spanitemtwy" id="tw1sp_minus" style="height: 52px; line-height: 52px; font-size: 18px;">−</span></a></td>
                                        <td class="colcentered texto-stn" colspan="3"><span style="font-size: 79px;" id="tw1">---</span></td>
                                        <td class="tdstn"><a href="#"><span title="+5° TW1" class="spanitemtw spanitemtwy" id="tw1sp_plus" style="height: 52px; line-height: 52px; font-size: 18px;">+</span></a></td>
                                        <td><span class="spanitem spanitemw" id="tw1stn2">STN2</span></td>
                                </tr>

                                <tr>
                                        <td class="tdstn"><a href="#"><span title="SAf" onclick="send_command('tw1/set/deg', 170)" class="spanitemtw" id="tw1sp0">SAf</span></a></td>
                                        <td class="tdstn"><a href="#"><span title="SAm" onclick="send_command('tw1/set/deg', 225)" class="spanitemtw" id="tw1sp1">SAm</span></a></td>
                                        <td class="tdstn"><a href="#"><span title="CAm" onclick="send_command('tw1/set/deg', 265)" class="spanitemtw" id="tw1sp2">CAm</span></a></td>
                                        <td class="tdstn"><a href="#"><span title="NAm" onclick="send_command('tw1/set/deg', 300)" class="spanitemtw" id="tw1sp3">NAm</span></a></td>
                                        <td class="tdstn"><a href="#"><span title="JA" onclick="send_command('tw1/set/deg', 27)" class="spanitemtw" id="tw1sp4">JA</span></a></td>
                                        <td class="tdstn"><a href="#"><span title="EU" onclick="send_command('tw1/set/deg', 45)" class="spanitemtw" id="tw1sp5">EU</span></a></td>
                                        <td class="tdstn"><a href="#"><span title="MEa" onclick="send_command('tw1/set/deg', 80)" class="spanitemtw" id="tw1sp6">MEa</span></a></td>
                                </tr>
                        </table>
                </div>
        </body>
</html>

<script>
  ["tw1", "tw3"].forEach(id => {
    const el = document.getElementById(id);
    el.addEventListener("click", () => {
      const current = el.textContent.trim();
      const nuevo = prompt(`Introduce la dirección para mástil ${id.toUpperCase()}:`, current === "---" ? "" : current);

      if (nuevo !== null && nuevo.trim() !== "" && nuevo >= 0 && nuevo <= 360) {
        const valor = parseFloat(nuevo);
        if (!isNaN(valor)) {
          send_command(`${id}/set/deg`, valor);
        }
      }
    });
  });
</script>

<script>
function ajustarTw(twId, delta) {
  // ejemplo: twId = 'tw1'
  const el = document.getElementById(`${twId}set`);
  if (!el) return;

  const current = parseInt(el.textContent);
  if (isNaN(current)) return;

        let nuevo = current + delta;
        if (nuevo >= 360) nuevo = nuevo - 360;
        if (nuevo < 0)  nuevo = 360 + delta;
  send_command(`${twId}/set/deg`, nuevo);
}

// Asignar eventos a todos los botones ±5
['tw1', 'tw3'].forEach(tw => {
  document.getElementById(`${tw}sp_plus`).addEventListener('click', () => ajustarTw(tw, +5));
  document.getElementById(`${tw}sp_minus`).addEventListener('click', () => ajustarTw(tw, -5));
});
</script>
